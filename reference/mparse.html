<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Model parser to define new models to run in SimInf — mparse • SimInf</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model parser to define new models to run in SimInf — mparse"><meta name="description" content="Describe your model in a logical way in R. mparse creates a
SimInf_model object with your model
definition that is ready to run."><meta property="og:description" content="Describe your model in a logical way in R. mparse creates a
SimInf_model object with your model
definition that is ready to run."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SimInf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">10.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/mparse.html">Getting started with `mparse`</a></li>
    <li><a class="dropdown-item" href="../articles/post-process-data.html">Post-process data in a trajectory</a></li>
    <li><a class="dropdown-item" href="../articles/scheduled-events.html">Scheduled events</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stewid/SimInf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Model parser to define new models to run in <code>SimInf</code></h1>
      <small class="dont-index">Source: <a href="https://github.com/stewid/SimInf/blob/main/R/mparse.R" class="external-link"><code>R/mparse.R</code></a></small>
      <div class="d-none name"><code>mparse.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Describe your model in a logical way in R. <code>mparse</code> creates a
<code><a href="SimInf_model-class.html">SimInf_model</a></code> object with your model
definition that is ready to <code><a href="run.html">run</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mparse</span><span class="op">(</span></span>
<span>  transitions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  compartments <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ldata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  u0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  v0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tspan <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  events <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  E <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  N <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pts_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_enum <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-transitions">transitions<a class="anchor" aria-label="anchor" href="#arg-transitions"></a></dt>
<dd><p>character vector containing transitions on the
form <code>"X -&gt; ... -&gt; Y"</code>. The left (right) side is the
initial (final) state and the propensity is written in between
the <code>-&gt;</code>-signs. The special symbol <code>@</code> is reserved
for the empty set. For example, <code>transitions =
c("S -&gt; beta*S*I/(S+I+R) -&gt; I", "I -&gt; gamma*I -&gt; R")</code>
expresses the SIR model. It is also possible to define
variables which can then be used in calculations of
propensities or in calculations of other variables. A variable
is defined by the operator <code>&lt;-</code>. Using a variable for the
size of the population, the SIR model can instead be written
<code>transitions = c("S -&gt; beta*S*I/N -&gt; I",
"I -&gt; gamma*I -&gt; R", "N &lt;- S+I+R")</code>. By default, the type of a
variable is defined as a double in the generated C code, but
it is possible to also define it as an integer by writing
<code>(int)</code> before the variable name. For example, for the
SIR model, the population size can be defined as
<code>"(int)N &lt;- S+I+R"</code>. It is also possible to explicitly
use (double) in front of the variable name, but it is not
needed because it is the default. Note that the order of
propensities and variables does not matter.</p></dd>


<dt id="arg-compartments">compartments<a class="anchor" aria-label="anchor" href="#arg-compartments"></a></dt>
<dd><p>contains the names of the involved
compartments, for example, <code>compartments = c("S", "I",
"R")</code>.</p></dd>


<dt id="arg-ldata">ldata<a class="anchor" aria-label="anchor" href="#arg-ldata"></a></dt>
<dd><p>optional data for the nodes. Can be specified as a
<code>data.frame</code> with one row per node, as a numeric matrix
where column <code>ldata[, j]</code> contains the local data vector
for the node <code>j</code>, or as a as a named vector when the
model only contains one node. If <code>ldata</code> is specified as
a <code>data.frame</code>, each column is one parameter. If
<code>v0</code> is specified as a matrix, it must have row names to
identify the parameters in the transitions. If <code>v0</code> is
specified as a named vector, the names identify the
parameters. The local data vector is passed as an argument to
the transition rate functions and the post time step function.</p></dd>


<dt id="arg-gdata">gdata<a class="anchor" aria-label="anchor" href="#arg-gdata"></a></dt>
<dd><p>optional data that are common to all nodes in the
model. Can be specified either as a optionally named numeric
vector or as as a one-row data.frame. The names are used to
identify the parameters in the transitions. When <code>gdata</code>
is specified as a vector, it is possible to have parameters
without names, however, these parameters will not be
automatically identified by mparse but need to be identified
in the code by the user. The global data vector is passed as
an argument to the transition rate functions and the post time
step function.</p></dd>


<dt id="arg-u-">u0<a class="anchor" aria-label="anchor" href="#arg-u-"></a></dt>
<dd><p>A <code>data.frame</code> with the initial state in each node,
i.e., the number of individuals in each compartment in each
node when the simulation starts (see ‘Details’). The
parameter <code>u0</code> can also be an object that can be coerced
to a <code>data.frame</code>, e.g., a named numeric vector will be
coerced to a one row <code>data.frame</code>.</p></dd>


<dt id="arg-v-">v0<a class="anchor" aria-label="anchor" href="#arg-v-"></a></dt>
<dd><p>optional data with the initial continuous state in each
node. <code>v0</code> can be specified as a <code>data.frame</code> with
one row per node, as a numeric matrix where column <code>v0[,
j]</code> contains the initial state vector for the node <code>j</code>,
or as a named vector when the model only contains one node. If
<code>v0</code> is specified as a <code>data.frame</code>, each column is
one parameter. If <code>v0</code> is specified as a matrix, the row
names identify the parameters. If <code>v0</code> is specified as a
named vector, the names identify the parameters. The
‘v’ vector is passed as an argument to the transition
rate functions and the post time step function. The continuous
state can be updated in the post time step function.</p></dd>


<dt id="arg-tspan">tspan<a class="anchor" aria-label="anchor" href="#arg-tspan"></a></dt>
<dd><p>A vector (length &gt;= 1) of increasing time points
where the state of each node is to be returned. Can be either
an <code>integer</code> or a <code>Date</code> vector. A <code>Date</code>
vector is coerced to a numeric vector as days, where
<code>tspan[1]</code> becomes the day of the year of the first year
of <code>tspan</code>. The dates are added as names to the numeric
vector.</p></dd>


<dt id="arg-events">events<a class="anchor" aria-label="anchor" href="#arg-events"></a></dt>
<dd><p>A <code>data.frame</code> with the scheduled
events. Default is <code>NULL</code> i.e. no scheduled events in the
model.</p></dd>


<dt id="arg-e">E<a class="anchor" aria-label="anchor" href="#arg-e"></a></dt>
<dd><p>matrix to handle scheduled events, see
<code><a href="SimInf_events-class.html">SimInf_events</a></code> and
<code><a href="SimInf_model-class.html">SimInf_model</a></code> for how <code>E</code> can be
specified. Default is <code>NULL</code> i.e. no scheduled events in
the model.</p></dd>


<dt id="arg-n">N<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>matrix to handle scheduled events, see
<code><a href="SimInf_events-class.html">SimInf_events</a></code>. Default is <code>NULL</code>
i.e. no scheduled events in the model.</p></dd>


<dt id="arg-pts-fun">pts_fun<a class="anchor" aria-label="anchor" href="#arg-pts-fun"></a></dt>
<dd><p>optional character vector with C code for the post
time step function. The C code should contain only the body of
the function i.e. the code between the opening and closing
curly brackets.</p></dd>


<dt id="arg-use-enum">use_enum<a class="anchor" aria-label="anchor" href="#arg-use-enum"></a></dt>
<dd><p>generate enumeration constants for the indices to
each parameter in the 'u', 'v', 'ldata', and 'gdata' vectors
in the generated C code. The name of each enumeration constant
will be transformed to the upper-case name of the
corresponding parameter, for example, a parameter 'beta' will
become 'BETA'. The enumeration constants 'N_COMPARTMENTS_U'
and 'N_COMPARTMENTS_V' will be automatically added to
facilitate indexing 'u' and 'v' in the C code. These two
enumeration constants cannot be used as a compartment or
variable name. Using enumeration constants can make it easier
to modify the C code afterwards, or when writing C code for
the <code>pts_fun</code> parameter. Default is <code>FALSE</code>, i.e.,
the parameters are specified by using integer indices for the
parameters.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <code><a href="SimInf_model-class.html">SimInf_model</a></code> object</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">## Use the model parser to create a 'SimInf_model' object that</span></span></span>
<span class="r-in"><span><span class="co">## expresses the SIR model, where 'beta' is the transmission rate</span></span></span>
<span class="r-in"><span><span class="co">## and 'gamma' is the recovery rate.</span></span></span>
<span class="r-in"><span><span class="va">model</span>  <span class="op">&lt;-</span> <span class="fu">mparse</span><span class="op">(</span>transitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S -&gt; beta*S*I/N -&gt; I"</span>,</span></span>
<span class="r-in"><span>                                 <span class="st">"I -&gt; gamma*I -&gt; R"</span>,</span></span>
<span class="r-in"><span>                                 <span class="st">"N &lt;- S+I+R"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 compartments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 gdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0.16</span>, gamma <span class="op">=</span> <span class="fl">0.077</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 u0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">100</span>, I <span class="op">=</span> <span class="fl">1</span>, R <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 tspan <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Run and plot the result</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">22</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="run.html">run</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Stefan Widgren, Robin Eriksson, Stefan Engblom, Pavol Bauer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

