<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Approximate Bayesian computation — abc • SimInf</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Approximate Bayesian computation — abc"><meta name="description" content="Approximate Bayesian computation"><meta property="og:description" content="Approximate Bayesian computation"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SimInf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">10.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/mparse.html">Getting started with `mparse`</a></li>
    <li><a class="dropdown-item" href="../articles/post-process-data.html">Post-process data in a trajectory</a></li>
    <li><a class="dropdown-item" href="../articles/scheduled-events.html">Scheduled events</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stewid/SimInf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Approximate Bayesian computation</h1>
      <small class="dont-index">Source: <a href="https://github.com/stewid/SimInf/blob/main/R/abc.R" class="external-link"><code>R/abc.R</code></a></small>
      <div class="d-none name"><code>abc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Approximate Bayesian computation</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">abc</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  priors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_particles <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  distance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"verbose"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  post_gen <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  init_model <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'SimInf_model'</span></span>
<span><span class="fu">abc</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  priors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_particles <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  distance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"verbose"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  post_gen <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  init_model <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The <code>SimInf_model</code> object to generate data from.</p></dd>


<dt id="arg-priors">priors<a class="anchor" aria-label="anchor" href="#arg-priors"></a></dt>
<dd><p>The priors for the parameters to fit. Each prior is
specified with a formula notation, for example, <code>beta ~
uniform(0, 1)</code> specifies that beta is uniformly distributed
between 0 and 1. Use <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> to provide more than one
prior, for example, <code>c(beta ~ uniform(0, 1), gamma ~
normal(10, 1))</code>. The following distributions are supported:
<code>gamma</code>, <code>lognormal</code>, <code>normal</code> and
<code>uniform</code>. All parameters in <code>priors</code> must be only
in either <code>gdata</code> or <code>ldata</code>.</p></dd>


<dt id="arg-n-particles">n_particles<a class="anchor" aria-label="anchor" href="#arg-n-particles"></a></dt>
<dd><p>An integer <code>(&gt;1)</code> specifying the number of
particles to approximate the posterior with.</p></dd>


<dt id="arg-n-init">n_init<a class="anchor" aria-label="anchor" href="#arg-n-init"></a></dt>
<dd><p>Specify a positive integer (&gt;<code>n_particles</code>) to
adaptively select a sequence of tolerances using the algorithm
of Simola and others (2021). The initial tolerance is
adaptively selected by sampling <code>n_init</code> draws from the
prior and then retain the <code>n_particles</code> particles with
the smallest distances. Note there must be enough initial
particles to satisfactorily explore the parameter space, see
Simola and others (2021). If the <code>tolerance</code> parameter is
specified, then <code>n_init</code> must be <code>NULL</code>.</p></dd>


<dt id="arg-distance">distance<a class="anchor" aria-label="anchor" href="#arg-distance"></a></dt>
<dd><p>A function for calculating the summary statistics
for a simulated trajectory. For each particle, the function
must determine the distance and return that information. The
first argument, <code>result</code>, passed to the <code>distance</code>
function is the result from a <code>run</code> of the model with one
trajectory attached to it. The second argument,
<code>generation</code>, to <code>distance</code> is an integer with the
generation of the particle(s). Further arguments that can
passed to the <code>distance</code> function comes from <code>...</code>
in the <code>abc</code> function. Depending on the underlying model
structure, data for one or more particles have been generated
in each call to <code>distance</code>. If the <code>model</code> only
contains one node and all the parameters to fit are in
<code>ldata</code>, then that node will be replicated and each of
the replicated nodes represent one particle in the trajectory
(see ‘Examples’). On the other hand if the model
contains multiple nodes or the parameters to fit are contained
in <code>gdata</code>, then the trajectory in the <code>result</code>
argument represents one particle. The function can return a
numeric matrix (number of particles \(\times\) number of
summary statistics). Or, if the distance contains one summary
statistic, a numeric vector with the length equal to the
number of particles. Note that when using adaptive tolerance
selection, only one summary statistic can be used, i.e., the
function must return a matrix (number of particles
\(\times\) 1) or a numeric vector.</p></dd>


<dt id="arg-tolerance">tolerance<a class="anchor" aria-label="anchor" href="#arg-tolerance"></a></dt>
<dd><p>A numeric matrix (number of summary statistics
\(\times\) number of generations) where each column contains
the tolerances for a generation and each row contains a
sequence of gradually decreasing tolerances. Can also be a
numeric vector if there is only one summary statistic. The
tolerance determines the number of generations of ABC-SMC to
run. If the <code>n_init</code> parameter is specified, then
<code>tolerance</code> must be <code>NULL</code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Optional data to be passed to the <code>distance</code>
function. Default is <code>NULL</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>prints diagnostic messages when <code>TRUE</code>. The
default is to retrieve the global option <code>verbose</code> and
use <code>FALSE</code> if it is not set.</p></dd>


<dt id="arg-post-gen">post_gen<a class="anchor" aria-label="anchor" href="#arg-post-gen"></a></dt>
<dd><p>An optional function that, if non-NULL, is applied
after each completed generation. The function must accept one
argument of type <code>SimInf_abc</code> with the current state of
the fitting process. This function can be useful to, for
example, save and inspect intermediate results.</p></dd>


<dt id="arg-init-model">init_model<a class="anchor" aria-label="anchor" href="#arg-init-model"></a></dt>
<dd><p>An optional function that, if non-NULL, is
applied before running each proposal. The function must accept
one argument of type <code>SimInf_model</code> with the current
model of the fitting process. This function can be useful to
specify the initial state of <code>u0</code> or <code>v0</code> of the
model before running a trajectory with proposed parameters.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>SimInf_abc</code> object.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>T. Toni, D. Welch, N. Strelkowa, A. Ipsen, and M. P. H. Stumpf. Approximate Bayesian computation scheme for parameter inference and model selection in dynamical systems. <em>Journal of the Royal Society Interface</em> <strong>6</strong>, 187–202, 2009. <a href="https://doi.org/10.1098/rsif.2008.0172" class="external-link">doi:10.1098/rsif.2008.0172</a></p>
<p>U. Simola, J. Cisewski-Kehe, M. U. Gutmann, J. Corander. Adaptive Approximate Bayesian Computation Tolerance Selection. <em>Bayesian Analysis</em>, <strong>16</strong>(2), 397–423, 2021. doi: 10.1214/20-BA1211</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="continue_abc.html">continue_abc</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">## Let us consider an SIR model in a closed population with N = 100</span></span></span>
<span class="r-in"><span><span class="co">## individuals of whom one is initially infectious and the rest are</span></span></span>
<span class="r-in"><span><span class="co">## susceptible. First, generate one realisation (with a specified</span></span></span>
<span class="r-in"><span><span class="co">## seed) from the model with known parameters \code{beta = 0.16} and</span></span></span>
<span class="r-in"><span><span class="co">## \code{gamma = 0.077}. Then, use \code{abc} to infer the (known)</span></span></span>
<span class="r-in"><span><span class="co">## parameters from the simulated data.</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="SIR.html">SIR</a></span><span class="op">(</span>u0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">99</span>, I <span class="op">=</span> <span class="fl">1</span>, R <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             tspan <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>             beta <span class="op">=</span> <span class="fl">0.16</span>,</span></span>
<span class="r-in"><span>             gamma <span class="op">=</span> <span class="fl">0.077</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Run the SIR model and plot the number of infectious.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">22</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">infectious</span> <span class="op">&lt;-</span> <span class="fu"><a href="trajectory.html">trajectory</a></span><span class="op">(</span><span class="fu"><a href="run.html">run</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>, <span class="st">"I"</span><span class="op">)</span><span class="op">$</span><span class="va">I</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">infectious</span>, type <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The distance function to accept or reject a proposal. Each node</span></span></span>
<span class="r-in"><span><span class="co">## in the simulated trajectory (contained in the 'result' object)</span></span></span>
<span class="r-in"><span><span class="co">## represents one proposal.</span></span></span>
<span class="r-in"><span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">result</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co">## Extract the time-series of infectious in each node as a</span></span></span>
<span class="r-in"><span>    <span class="co">## data.frame.</span></span></span>
<span class="r-in"><span>    <span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="trajectory.html">trajectory</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"I"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">## Split the 'sim' data.frame by node and calculate the sum of the</span></span></span>
<span class="r-in"><span>    <span class="co">## squared distance at each time-point for each node.</span></span></span>
<span class="r-in"><span>    <span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">I</span>, <span class="va">sim</span><span class="op">$</span><span class="va">node</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sim_infectious</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">infectious</span> <span class="op">-</span> <span class="va">sim_infectious</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">## Return the distance for each node. Each proposal will be</span></span></span>
<span class="r-in"><span>    <span class="co">## accepted or rejected depending on if the distance is less than</span></span></span>
<span class="r-in"><span>    <span class="co">## the tolerance for the current generation.</span></span></span>
<span class="r-in"><span>    <span class="va">dist</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Fit the model parameters using ABC-SMC and adaptive tolerance</span></span></span>
<span class="r-in"><span><span class="co">## selection. The priors for the parameters are specified using a</span></span></span>
<span class="r-in"><span><span class="co">## formula notation. Here we use a uniform distribtion for each</span></span></span>
<span class="r-in"><span><span class="co">## parameter with lower bound = 0 and upper bound = 1. Note that we</span></span></span>
<span class="r-in"><span><span class="co">## use a low number particles here to keep the run-time of the example</span></span></span>
<span class="r-in"><span><span class="co">## short. In practice you would want to use many more to ensure better</span></span></span>
<span class="r-in"><span><span class="co">## approximations.</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">abc</span><span class="op">(</span>model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>           priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">beta</span> <span class="op">~</span> <span class="fu">uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">gamma</span> <span class="op">~</span> <span class="fu">uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           n_particles <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>           n_init <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>           distance <span class="op">=</span> <span class="va">distance</span>,</span></span>
<span class="r-in"><span>           verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Print a brief summary.</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Display the ABC posterior distribution.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Stefan Widgren, Robin Eriksson, Stefan Engblom, Pavol Bauer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

